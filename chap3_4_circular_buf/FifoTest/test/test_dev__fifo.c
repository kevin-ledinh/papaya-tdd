/*============================================================================
@brief A C source template
------------------------------------------------------------------------------
<!-- Written by Kevin (Phuc) Le Dinh -->
<!-- Copyright (C) 2018 All rights reserved -->
============================================================================*/

/*----------------------------------------------------------------------------
  @brief
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  include files
----------------------------------------------------------------------------*/
#include "unity.h"
#include "hw__fake_memory.h"
#include "dev__fifo.h"
#include <stdint.h>

/*----------------------------------------------------------------------------
  manifest constants
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  type definitions
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  macros
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  prototypes
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  global variables
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  static variables
----------------------------------------------------------------------------*/
static uint8_t temp_packet[] = 
{ 
    0x0D , 0x0A , 0x3E , 0x3E , 0x4D , 0x24 , 0x62 , 0x5A , 0x02 , 0x01 , 0x17 
};

/*----------------------------------------------------------------------------
  public functions
----------------------------------------------------------------------------*/

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
void setUp(void)
{
    dev__fifo_init();
}

void tearDown(void)
{
    dev__fifo_deinit();
}

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
void test_dev__fifo_EmptyAfterCreation(void)
{
    
    TEST_ASSERT_TRUE( dev__fifo_is_empty() );
}

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
void test_dev__fifo_NotEmpty(void)
{
    dev__fifo_put( temp_packet , sizeof ( temp_packet ) );
    TEST_ASSERT_FALSE( dev__fifo_is_empty() );
}

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
void test_dev__fifo_NotEmptyThenEmpty(void)
{
    uint8_t test_value = 0xFF;
    dev__fifo_put( & test_value , 1 );
    TEST_ASSERT_FALSE( dev__fifo_is_empty() );
    uint8_t return_value = dev__fifo_get();
    TEST_ASSERT_TRUE( dev__fifo_is_empty() );
}

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
void test_dev__fifo_GetPutOneValue(void)
{
    uint8_t test_value = 0xFF;
    dev__fifo_put( & test_value , 1 );
    TEST_ASSERT_EQUAL_UINT8( test_value , dev__fifo_get() );
}

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
void test_dev__fifo_GetPutAFew(void)
{
    dev__fifo_put( temp_packet , sizeof ( temp_packet ) );
    for( int idx = 0 ; idx < sizeof ( temp_packet ) ; idx ++ )
    {
        TEST_ASSERT_EQUAL_UINT8( temp_packet[ idx ] , dev__fifo_get() );
    }
}

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
void test_dev__fifo_IsFull(void)
{
    uint8_t temp = 0;
    for( int idx = 0 ; idx < MAX_FIFO_LEN ; idx ++ )
    {
        temp = ( uint8_t ) ( idx & 0xFF );
        dev__fifo_put( & temp , 1 );
    }
    printf("size: %d" , dev__fifo_get_current_size() );
    TEST_ASSERT_TRUE( dev__fifo_is_full() );
}

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
void test_dev__fifo_EmptyToFullToEmpty(void)
{
    uint8_t temp = 0;
    for( int idx = 0 ; idx < MAX_FIFO_LEN ; idx ++ )
    {
        temp = ( uint8_t ) ( idx & 0xFF );
        dev__fifo_put( & temp , 1 );
    }
    TEST_ASSERT_TRUE( dev__fifo_is_full() );

    for( int idx = 0 ; idx < MAX_FIFO_LEN ; idx ++ )
    {
        temp = dev__fifo_get();
    }
    TEST_ASSERT_TRUE( dev__fifo_is_empty() );
}

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
void test_dev__fifo_WrapAround(void)
{
    uint8_t temp = 100;
    for( int idx = 0 ; idx < MAX_FIFO_LEN ; idx ++ )
    {
        dev__fifo_put( & temp , 1 );
    }
    TEST_ASSERT_TRUE( dev__fifo_is_full() );
    TEST_ASSERT_EQUAL_UINT8( 100 , dev__fifo_get() );
    TEST_ASSERT_FALSE( dev__fifo_is_full() );
    temp = 0x22;
    dev__fifo_put( & temp , 1 );
    TEST_ASSERT_TRUE( dev__fifo_is_full() );

    for( int idx = 1 ; idx < MAX_FIFO_LEN ; idx ++ )
    {
        TEST_ASSERT_EQUAL_UINT8( 100 , dev__fifo_get() );
    }
    TEST_ASSERT_EQUAL_UINT8( 0x22 , dev__fifo_get() );
    TEST_ASSERT_TRUE( dev__fifo_is_empty() );
}
/*----------------------------------------------------------------------------
  private functions
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  End of file
----------------------------------------------------------------------------*/